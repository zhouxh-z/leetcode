_`## 1、mysql 数据库表类型：innodb\myisam
有什么区别？
1、innodb 的数据和索引在同一个文件中（主键索引），myisam 的数据和索引不在同一个文件中（主键索引），索引中保存的是数据的磁盘地址

## 2、mysql 有哪些索引结构
1、B+Tree 索引 --- innodb 和 myisam 默认索引结构
    -- 数据格式决定了 他的优劣势：1、适合范围和排序查询
2、hash 索引 
    -- 适合 = 查询，范围查和排序查询不支持

## sql 优化 可以通过 explain 查询 sql 的执行情况
主要关注 type 这个类型
system > const > eq_ref > ref > range > index > ALL

## 什么叫回表
但数据库存在主键索引和非主键索引时，当通过非主键索引无法获取查询的所有字段时，需非主键索引查询后，获取主键id 从主键索引中获取字段

## 索引下推
name Like 'zxh%' and age = 20 and sex = 1
索引 name+age+sex 的 情况下
like 查询时，如果有聚集索引，like在前面，也能走索引

## 事务
事务的特性：
ACID
A：原子性 通过undo日志实现
C：一致性
I：隔离性 通过锁和 mvcc 机制实现
D：持久性 通过redo日志实现

### 事务隔离级别
read uncommit（读未提交）
read commit （读已提交）
repeatable read （可重复读）
serializable （串行执行）

### MVCC 机制
多版本并发控制  --> 通过undo日志实现，读取时读“快照”（undo日志链），写时使用最新数据
事务id：事务id是，mysql开启一个事务时分配的递增id，每条数据都有一个事务id 的隐藏字段

mvcc 维护 一系列的事务id
1、最小获取事务id
2、最大事务id
3、活跃事务id

mvcc 会判断当前事务id 和 维护的一系列 事务id的关系 ，进而根据隔离级别，判断是否能读取到

read commit （读已提交）：判断所有非活跃事务id（维护了一个活跃事务id的集合）的最新数据（每次select都会进行确认可见性）
repeatable read （可重复读）：小于最小活跃事务id 或者 小于最大事务id，且不属于活跃事务id` `的 数据；（第一次select时 进行确认可见性）

## 锁：锁是加在索引上的
读锁、写锁
行锁、页锁（BDB 引擎）、表锁
间隙锁、临键锁（可重复读）
innodb才支持行锁

如果加锁字段（where 条件）没有索引，行锁会升级成表锁
原因是 可重复读场景下，当where条件无法通过索引获取记录时，会扫描大量记录行并加锁，当锁定行记录超过一定的阈值（1\10）时,行锁就会升级成表锁，从而减少行锁的加/解锁的开销

## mysql 的执行过程 
客户端发起sql执行 
-> sql 连接器 
-> server层（ sql 分析器 -> sql 优化器 -> sql 执行器 ） 
-> 引擎层（写操作：磁盘idb文件加载 buffer pool 缓存池 -> 写undo回滚日志 -> 把缓存池的数据更新/写入 -> 写redo日志,刷进磁盘 ->【server层执行commit】提交事务，同时写binlog日志 -> redo 日志写入commit标识）
-> 写入os缓存 
-> 刷盘

### buffer pool 缓存池，为什么这么设计，有什么优势
内存和磁盘的速度差异，减少磁盘访问；
    -- 查询时如果命中缓存，可以快速响应；
    -- 写入时，先写缓存，异步刷盘；
    -- 可以合并多个写操作，一次刷盘；

### 什么是undo 日志，什么作用
1、undo日志也叫回滚日志，再事务回滚时，通过undo日志的数据中的指针指向原始数据日志地址，从而快速回滚；
2、mvcc机制中通过undo日志版本链，通过事务id控制，读取范围；--- 事务隔离级别
数据格式：
【数据】 + 【事务id】 + 【旧数据指针】

### 什么是redo日志，什么作用
redo日志 也叫重做日志，是保证事务持久性的重要机制，记录了磁盘物理修改的记录
1、保证持久性，确保已经提交的数据，不会因为系统崩溃而消失
2、允许"延迟写入"：事务提交时只需确保Redo日志落盘，数据页可以延迟写入
3、崩溃恢复：数据库重启时重放(redo)已提交但未写入数据文件的事务

redo 日志的特性
系统预创建了几个固定大小的redo日志，并循环写入其中，无需再写入时重新分配内存； --- 顺序写
日志首尾相接

### 什么是binlog日志，什么作用 
主要用于主从复制，以及错误丢失（删除）的数据还原

## mysql 8.0 新特性
1、倒叙索引
2、group by 不在默认排序
3、隐藏索引
4、函数索引
5、索引跳跃扫描：对最左前缀原理的优化

## 项目场景下怎么分库分表，为什么要分库分表

## truncate\delete\drop 有什么区别
truncate：删除全表数据，通常不支持事务，不会触发行级的触发器，自增的值会重置
delete：删除多行数据，支持事务，触发行级触发器
drop：删除整个表，不支持事务

## 索引覆盖
是指查询的数据全部都在索引上能找到，无需进行回表查询的情况